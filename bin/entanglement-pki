#!/usr/bin/python3
# Copyright (C) 2017, Hadron Industries, Inc.
# Entanglement is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License version 3
# as published by the Free Software Foundation. It is distributed
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the file
# LICENSE for details.

import argparse, os, os.path, sys
_entanglement = os.path.join(os.path.dirname(__file__), '../entanglement')
if os.path.exists(_entanglement):
    sys.path.append(os.path.join(_entanglement,'..'))


from entanglement.pki import host_cert
from entanglement.util import certhash_from_file, CertHash

parser = argparse.ArgumentParser()

parser.add_argument('--pki-dir', '-d', default = '/etc/photon/pki')

parser.add_argument('hosts', nargs = '*')
parser.add_argument('--hash', nargs = '+')

args = parser.parse_args()

for h in args.hash or []:
    ch = certhash_from_file(h)
    print(ch)

for h in args.hosts or []:
    host_cert(args.pki_dir, h)
